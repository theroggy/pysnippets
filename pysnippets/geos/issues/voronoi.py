import shapely
import shapely.plotting as plotter
from matplotlib import pyplot as plt

wkt = "POLYGON ((178951.875 232219.875, 178944.875 232221.875, 178937.875 232223.875, 178935.5 232229, 178933.125 232234.125, 178930.125 232238.125, 178926.6875 232246.125, 178923.25 232254.125, 178919.8125 232262.125, 178916.375 232270.125, 178914.875 232276.375, 178913.375 232282.625, 178913.375 232286.2398888889, 178913.375 232287.625, 178911.375 232290.625, 178911.20549768652 232290.82441448644, 178907.125 232295.625, 178905.125 232300.125, 178903.125 232303.375, 178912.375 232308.375, 178915.25 232302.875, 178918.125 232297.375, 178918.85213925343 232295.53897338512, 178918.852 232295.512, 178918.85213925343 232295.5389733851, 178921.44179962017 232289.00008095911, 178921.8446356772 232287.98291991506, 178924.9848178386 232280.05395995753, 178928.125 232272.125, 178929.125 232271.625, 178929.125 232266.625, 178931.375 232262.625, 178933.875 232256.875, 178937.875 232251.125, 178938.375 232248.875, 178939.375 232248.125, 178942.25 232242.875, 178945.125 232237.625, 178948.5 232228.75, 178951.875 232219.875))"  # noqa: E501

geom = shapely.from_wkt(wkt)
assert geom.is_valid

for tol in [0.01, 0.1]:
    try:
        geom_cleaned = shapely.remove_repeated_points(geom, tolerance=tol)
        voronoi = shapely.voronoi_polygons(geom_cleaned)
        print(f"WKT with {tol=}: {wkt[:30]}: OK")
    except Exception as ex:
        print(f"WKT with {tol=}: {wkt[:30]}: ERROR: {ex}")
        geom_cleaned = shapely.set_precision(geom, 1e-8)
        voronoi = shapely.voronoi_polygons(geom_cleaned)
        print(f"WKT after set_precision(1e-8): {wkt[:30]}: OK")

plotter.plot_polygon(geom, edgecolor="black", facecolor="none")
plt.show()
