"""
Reported in https://github.com/libgeos/geos/issues/985
"""

import shapely

poly = shapely.from_wkt(
    "POLYGON ((26322.951 175085.358, 26322.886000000002 175086.249, 26322.885000000002 175086.259, 26322.882 175086.298, 26322.883 175086.296, 26322.88 175086.33000000002, 26322.872 175086.378, 26322.86 175086.45, 26322.762 175087.809, 26322.762 175087.814, 26322.762 175087.81900000002, 26322.763 175087.81100000002, 26322.762 175087.821, 26322.73 175088.26, 26323.06 175089.91, 26323.600000000002 175091.12, 26324.72 175092.5, 26332.05 175098.07, 26336.4 175100.88, 26339.54 175103.11000000002, 26339.99 175103.43, 26342.81 175105.1, 26343.58 175105.42, 26343.59 175105.42500000002, 26344.37 175105.75, 26345.8 175105.75, 26348.14 175104.92, 26349.27 175102.9, 26349.5 175102.87, 26350.546000000002 175101.615, 26350.55 175101.61000000002, 26350.548 175101.609, 26350.33 175101.44, 26351.799 175098.405, 26352.46 175097.04, 26352.491 175096.88, 26352.498 175096.84456250002, 26352.498 175096.846, 26352.500379310324 175096.8325172415, 26352.507 175096.799, 26352.507333333335 175096.79633333333, 26352.514 175096.763, 26352.525 175096.711, 26352.536 175096.652, 26352.54 175096.63, 26353.03 175094.13, 26353.002 175093.98, 26352.84 175093.116, 26353 175093.98, 26352.853 175093.187, 26352.63 175092, 26351.59 175089.85, 26350.21 175088.869, 26349.863 175088.622, 26350.21 175088.87, 26347.253 175086.767, 26345.661 175085.635, 26345.43 175085.47, 26343.913 175084.82200000001, 26343.9104696912 175084.82093135302, 26343.23 175084.53, 26343.208000000002 175084.52300000002, 26343.205 175084.522, 26343.204 175084.522, 26343.206000000002 175084.52300000002, 26343.20633333338 175084.52300000002, 26343.337 175084.579, 26343.198 175084.52, 26343.196 175084.519, 26342.872 175084.415, 26342.377 175084.255, 26341.526 175083.981, 26332.81 175081.17, 26329.993000000002 175080.996, 26329.669 175080.976, 26328.11 175080.88, 26326 175081.16, 26325.54 175081.39, 26324.74 175081.79, 26323.81 175082.81, 26323.806 175082.814, 26323.649 175082.999, 26323.583000000002 175083.077, 26323.58 175083.081, 26323.100000000002 175084.59, 26323.579 175083.082, 26323.555 175083.11000000002, 26323.08 175083.67, 26323.010000000002 175084.55000000002, 26323.010000000002 175084.554, 26323.002 175084.665, 26322.954 175085.321, 26322.953 175085.325, 26322.952 175085.346, 26322.951 175085.358), (26322.766 175087.852, 26322.768 175087.843, 26322.766 175087.855, 26322.73 175088.26, 26322.766 175087.852), (26352.83 175094.97, 26352.34 175097.02, 26353.03 175094.13, 26352.83 175094.97), (26329.911 175081.07, 26329.91 175081.07, 26328.11 175080.88, 26329.911 175081.07), (26322.986 175085.469, 26322.984 175085.48500000002, 26323.07 175084.54, 26322.986 175085.469), (26352.528000000002 175096.676, 26352.528369565214 175096.67489130437, 26352.528140495866 175096.67619834712, 26352.52785714286 175096.67714285714, 26352.53 175096.66, 26352.528000000002 175096.676), (26352.525384615383 175096.6911538462, 26352.52 175096.71, 26352.525975609762 175096.68780487802, 26352.525384615383 175096.6911538462))"
)

poly = shapely.from_wkt(
    "Polygon ((26352.5 175096.6, 26352.6 175096.6, 26352.6 175096.7, 26352.5 175096.7, 26352.5 175096.6),(26352.528000000002 175096.676, 26352.528369565214 175096.67489130437, 26352.528140495866 175096.67619834712, 26352.52785714286 175096.67714285714, 26352.53 175096.66, 26352.528000000002 175096.676))"
)

print(f"poly.is_valid: {poly.is_valid}")

poly_precision = shapely.set_precision(poly, grid_size=0.001)
print(f"poly_precision.is_valid: {poly_precision.is_valid}")
