import subprocess

import shapely
import shapely.wkt

print('shapely.__version__:', shapely.__version__)

wkt1 = 'MULTIPOLYGON (((-78.04121599394897 -5.89365988248295, -79.46982124803172 -9.194972039429315, -31.771830845642597 -73.42037355623992, 47.69799040238911 -64.22540151681056, 79.46982124803172 9.194972039429311, 31.771830845642597 73.42037355623992, -47.69799040238911 64.22540151681056, -78.04121599394897 -5.89365988248295), (-44.94414807547773 60.517346154721146, 29.937481933257768 69.18144635507574, 74.88162621931913 8.664099761904156, 44.94414423125503 -60.51734611949454, -29.937485777480447 -69.18144631984912, -74.8816300087355 -8.664100200354595, -44.94414807547773 60.517346154721146)))'
wkt2 = 'MULTIPOLYGON (((-78.04121599394897 -5.89365988248295, -47.69799040238911 64.22540151681056, -79.22212318407406 -8.622575551695201, -78.04121599394897 -5.89365988248295)), ((79.46982124803172 9.194972039429311, 79.26313658326842 8.717351930944158, 79.46982124803172 9.194972039429313, 79.46982124803172 9.194972039429311)), ((-74.8816300087355 -8.664100200354591, -74.8816300087355 -8.66410020035459, -44.94414807547773 60.517346154721146, -74.8816300087355 -8.664100200354591)))'
mp1 = shapely.wkt.loads(wkt1)
mp2 = shapely.wkt.loads(wkt2)

print(f"{mp1.is_valid=}")
print(f"{mp2.is_valid=}")
print(f"{shapely.is_valid_reason(mp1.intersection(mp2))=}")

# Reproduce with geosop
geosop = "C:\\Tools\\miniforge3\\envs\\pysnippets\\Library\\bin\\geosop.exe"
cmdline = f'{geosop} -a "{wkt1}" -b "{wkt2}" intersection'
print(f'Run:\n{cmdline}\n')
output = subprocess.check_output(cmdline, shell=True)
print(f'GEOSOP output: {output.decode()}\n')

cmdline = f'{geosop} -a "{output.decode().strip()}" isValid'
print(f'Run:\n{cmdline}\n')
output = subprocess.check_output(cmdline, shell=True)
print(f'GEOSOP output: {output.decode()}\n')
